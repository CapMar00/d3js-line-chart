<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="#" type="image/x-icon">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.6.1/d3.min.js"
        integrity="sha512-MefNfAGJ/pEy89xLOFs3V6pYPs6AmUhXJrRlydI/9wZuGrqxmrdQ80zKHUcyadAcpH67teDZcBeS6oMJLPtTqw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <title>Prezzo del gasolio per il riscaldamento</title>
</head>

<body>
    <h1>Prezzo del gasolio per riscaldamento</h1>
    <p>Prezzi settimanali dal 2005 a oggi</p>

    <div id="container">
        <svg id="chart" width="700" height="400">
            <g id="chart_body" transform="translate(50,50)"">

            </g>
        </svg>
    </div>


    <div class=" source">Fonte: <a href="https://dgsaie.mise.gov.it/open-data" target="_blank"
                    rel="noopener noreferrer">Ministero della Transizione Ecologica - Direzione Generale Infrastrutture
                    e Sicurezza</a>
    </div>

    <script>
        const dateFormatter = d3.timeFormat("%d %B %Y");

        const body = d3.select("#chart_body")
        d3.csv("data/weekly_fuel_prices_from_2005_to_20221015.csv").then((data) =>
            createChart(data)
        )

        const createChart = (data) => {
            const width = 550;
            const height = 320;

            data = data.map(d => ({
                date: new Date(d.SURVEY_DATE),
                price: +d.HEATING_GAS_OIL
            }))


            const maxValue = d3.max(data, d => d.price)

            const yScale = d3.scaleLinear().range([height, 0]).domain([0, maxValue]);


            const xScale = d3.scaleTime().range([0, width]).domain(d3.extent(data, d => d.date))

            body.append("g").call(d3.axisLeft(yScale))
            body.append("g").attr("transform", `translate(0, ${height})`).call(d3.axisBottom(xScale))

            const line = d3.line()
                .x(d => xScale(d.date))
                .y(d => yScale(d.price))


            body.append("path")
                .datum(data)
                .attr("d", line)
                .attr("class", "line")


            let div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            body.selectAll("dot")
                .data(data)
                .enter().append("circle")
                .attr("r", 3)
                .attr("cx", (d) => xScale(d.date))
                .attr("cy", (d) => yScale(d.price))
                .style("opacity", 0)
                .on("mouseover", (d) => {
                    console.log("d", d); // d MouseEvent
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    div.html(dateFormatter(d.target['__data__']
                        .date) + "<br/>" + d.target['__data__']
                            .price)
                        .style("left", d.x + "px")
                        .style("top", d.y + "px");
                })
                .on("mouseout", (d) => {
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

        }

    </script>
</body>

</html>